{% extends "base.html" %}

{% block title %}Scans - Extension Security Auditor{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Historique des Scans</h1>
        <button class="btn btn-primary" onclick="loadScans()">
            <i class="bi bi-arrow-clockwise"></i> Actualiser
        </button>
    </div>
    
    <div class="stat-card">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Date et Heure</th>
                        <th>Machine</th>
                        <th>Chrome</th>
                        <th>Firefox</th>
                        <th>Edge</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody id="scans-table">
                    <tr>
                        <td colspan="7" class="text-center py-4">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Chargement...</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    async function loadScans() {
        try {
            const response = await fetch('/api/dashboard/scans');
            const scans = await response.json();
            renderScans(scans);
        } catch (error) {
            console.error('Erreur chargement scans:', error);
        }
    }
    
    function renderScans(scans) {
        const tbody = document.getElementById('scans-table');
        
        if (scans.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" class="text-center text-muted py-4">Aucun scan enregistr√©</td></tr>';
            return;
        }
        
        let html = '';
        scans.forEach(scan => {
            const scanDate = new Date(scan.scan_time);
            
            html += `
                <tr>
                    <td><strong>#${scan.id}</strong></td>
                    <td>${scanDate.toLocaleString('fr-FR')}</td>
                    <td><code>${escapeHtml(scan.hostname)}</code></td>
                    <td><span class="badge bg-primary">${scan.chrome}</span></td>
                    <td><span class="badge bg-warning">${scan.firefox}</span></td>
                    <td><span class="badge bg-info">${scan.edge}</span></td>
                    <td><strong>${scan.total}</strong></td>
                </tr>
            `;
        });
        
        tbody.innerHTML = html;
    }
    
    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
    
    loadScans();
</script>
{% endblock %}